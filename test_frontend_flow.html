<!DOCTYPE html>
<html>
<head>
    <title>Frontend Flow Test</title>
</head>
<body>
    <h1>Testing Frontend → Backend Flow</h1>
    <button onclick="testFlow()">Test Full Flow</button>
    <div id="output"></div>

    <script>
        async function testFlow() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Testing...</p>';
            
            try {
                // Simulate what StreamingControls does
                const telemetry = {
                    lap: 10,
                    fuel_level: 5.0,
                    speed: 200,
                    rpm: 12000,
                    gear: 6,
                    throttle: 100,
                    brake: 0,
                    drs: 1,
                    air_temp: 25,
                    track_temp: 45
                };
                
                console.log('1. Sending telemetry to /api/telemetry/stream...');
                const response = await fetch('http://localhost:3005/api/telemetry/stream', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(telemetry)
                });
                
                const data = await response.json();
                console.log('2. Received response:', data);
                
                if (data.success && data.recommendations) {
                    console.log('3. Storing in window.__latestRecommendation');
                    window.__latestRecommendation = {
                        ...data.recommendations,
                        scenario: 'TEST',
                        timestamp: Date.now()
                    };
                    console.log('4. Window object set:', window.__latestRecommendation);
                    
                    output.innerHTML = `
                        <h2>✅ SUCCESS!</h2>
                        <p><strong>Events:</strong> ${data.events?.length || 0}</p>
                        <p><strong>Recommendations:</strong> ${data.recommendations ? 'YES' : 'NO'}</p>
                        <p><strong>Window object:</strong> ${window.__latestRecommendation ? 'SET' : 'NOT SET'}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    output.innerHTML = `<p>❌ No recommendations in response</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
                
            } catch (error) {
                output.innerHTML = `<p>❌ Error: ${error.message}</p>`;
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>

